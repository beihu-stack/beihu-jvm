## JVM监控及诊断



- jps ：
  - 打印所有真在运行的Java进程信息，包括：基本的**进程ID**，主类，-l打印模块及包名，-v打印传递给JVM参数，-m打印传递给主类的参数
  - jps -mlv

- jstat：

  - 打印目标Java进程的性能数据

  - jstat -gc -t 10000 1s 4   (每一秒跑1次，共跑4次)

  - ```shell
    $ jstat -options
        -class ： 打印类加载相关数据
        -compiler ：打印即时编译相关数据
        -gc ：以gc开头的，将打印垃圾回收相关数据
        -gccapacity
        -gccause
        -gcmetacapacity
        -gcnew
        -gcnewcapacity
        -gcold
        -gcoldcapacity
        -gcutil
        -printcompilation ： 打印即时编译相关数据
        -t：打印进程运行实际
    ```

使用不同的垃圾回收器，jstat -gc的结果也有所不同

> **$ jstat -gc -t 94346 1s**

| Timestamp | S0C  | S1C   | S0U  | S1U   | EC    | EU    | OC     | OU      | MC    | MU      | CCSC | CCSU | YGC  | YGCT | FGC  | FGCT | CGC  | CGCT  | GCT   |
| :-------: | ---- | ----- | ---- | ----- | ----- | ----- | ------ | ------- | ----- | ------- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ----- | ----- |
|   2982    | 0    | 10240 | 0    | 10240 | 87040 | 19456 | 164864 | 77213.4 | 37504 | 36272.1 | 4224 | 3861 | 10   | 0.09 | 0    | 0    | 4    | 0.006 | 0.096 |
|  2982.9   | 0    | 10240 | 0    | 10240 | 87040 | 19456 | 164864 | 77213.4 | 37504 | 36272.1 | 4224 | 3861 | 10   | 0.09 | 0    | 0    | 4    | 0.006 | 0.096 |
|   2984    | 0    | 10240 | 0    | 10240 | 87040 | 19456 | 164864 | 77213.4 | 37504 | 36272.1 | 4224 | 3861 | 10   | 0.09 | 0    | 0    | 4    | 0.006 | 0.096 |
|   2985    | 0    | 10240 | 0    | 10240 | 87040 | 19456 | 164864 | 77213.4 | 37504 | 36272.1 | 4224 | 3861 | 10   | 0.09 | 0    | 0    | 4    | 0.006 | 0.096 |
|   2986    | 0    | 10240 | 0    | 10240 | 87040 | 19456 | 164864 | 77213.4 | 37504 | 36272.1 | 4224 | 3861 | 10   | 0.09 | 0    | 0    | 4    | 0.006 | 0.096 |
|   2987    | 0    | 10240 | 0    | 10240 | 87040 | 19456 | 164864 | 77213.4 | 37504 | 36272.1 | 4224 | 3861 | 10   | 0.09 | 0    | 0    | 4    | 0.006 | 0.096 |

- S：Survivor 区 ； E：Eden区 ； O：old区

- C：Capacity容量 ； U：Utility已使用量

- 我们可比较 Timestamp（进程启动时间） 和 GCT列（总GC时间），来**评估当前堆压力**，如果比例超过20%，说明当前堆压力较大，如果比例超过90%，说明堆几乎没有可用空间，随时可能抛出OOM异常。

- CGC：GC Stop-The-World的次数
- CGCT：GC Stop-The-World的时间
- OU：老年代使用量，多次取值，如果OU的值呈上涨趋势，说明Java程序老年代内存使用量不断上涨，无法回收的对象不断增加，因此很有可能存在**内存泄露**。